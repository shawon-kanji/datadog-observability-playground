apiVersion: apps/v1
kind: Deployment
metadata:
  name: dd-app-api
  labels:
    app: dd-app-api-deployment
spec:
  replicas: 1
  selector:
    matchLabels:
      app: dd-app-api
  template:
    metadata:
      labels:
        app: dd-app-api
    spec:
      containers:
        - name: dd-app-api
          image: "datadog-crud-api:latest"
          imagePullPolicy: Never
          ports:
            - containerPort: 3000
          env:
            - name: PORT
              value: "3000"
            - name: NODE_ENV
              value: "development"
            - name: MONGODB_URI
              value: "mongodb://mongo-service:27017/product-service"
            - name: ORDER_SERVICE_URL
              value: "http://order-service:3001"
            - name: JWT_SECRET
              value: "your-secret-key-change-in-production"
            - name: DD_SERVICE
              value: "product-service"
            - name: DD_ENV
              value: "development"
            - name: DD_VERSION
              value: "1.0.0"
          resources:
            requests:
              cpu: 100m        # Minimum CPU guaranteed
              memory: 128Mi    # Minimum memory guaranteed
            limits:
              cpu: 500m        # Maximum CPU allowed
              memory: 512Mi    # Maximum memory allowed

          # Liveness probe - Restart container if this fails
          livenessProbe:
            httpGet:
              path: /health
              port: 3000
              scheme: HTTP
            initialDelaySeconds: 30   # Wait 30s after container starts
            periodSeconds: 10         # Check every 10 seconds
            timeoutSeconds: 5         # Timeout after 5 seconds
            successThreshold: 1       # 1 success = healthy
            failureThreshold: 3       # 3 failures = restart container

          # Readiness probe - Remove from service if this fails
          readinessProbe:
            httpGet:
              path: /health
              port: 3000
              scheme: HTTP
            initialDelaySeconds: 10   # Wait 10s after container starts
            periodSeconds: 5          # Check every 5 seconds
            timeoutSeconds: 3         # Timeout after 3 seconds
            successThreshold: 1       # 1 success = ready
            failureThreshold: 3       # 3 failures = mark as not ready



